## 浏览器是如何工作的 ##



![](http://file.wangsijie.top/share/chongxuefe/6391573a276c47a9a50ae0cbd2c5844c.jpg)

1. 浏览器使用 HTTP / HTTPS 协议，向服务端请求页面
2. 解析请求到的 HTML 代码，构建成 DOM 树
3. 计算 DOM 树上的 CSS 属性
4. 根据 CSS 属性，逐个渲染，生成位图
5. 对位图进行合成
6. 合成后，绘制到界面上



上面的过程是流式的



### 一、HTTP 协议 ###

![](http://file.wangsijie.top/share/chongxuefe/3db5e0f362bc276b83c7564430ecb0a1.jpg)

304 协议：

客户端本地有了缓存版本， request 告诉服务端，

服务端通过时间或tag，发现没有更新

返回一个不含 body 的 304 状态



### 二、解析代码 ###

解析 HTTP 的 Response 的 body。

如：

```html
<p class="a">text text txr</p>
```

这段代码会依次拆成词（token）

- <p
- class="a"
- \>
- text text txr
- </p\>



状态机



### 三、计算 CSS 属性 ###



>  CSS 计算是把 CSS 规则应用到 DOM 树上，为 DOM 结构添加显示相关属性的过程



### 四、排版 ###



基本的排版方案是**正常流排版**，包含了顺次排布和折行等规则。

	遵循公认的文字排版规范，规定了**行模型**
	
	**盒模型**

正常流基础上，还支持

- **绝对定位元素**
- **浮动元素**



### 五、渲染 - 合成 - 绘制 ###

> render : 渲染
>
> 特指把模型变成位图的过程

浏览器中的渲染过程：把每一个元素对应的盒变成位图，每个元素可能对应多个盒，每一个盒对应一张位图。



> compositing : 合成
>
> 合成过程是一个性能考量，并非浏览器的必要一环

根据合成策略，“猜测”可能变化的元素，将他排除到合成之外。

最大限度减少绘制次数



> 绘制
>
> 位图最终绘制到屏幕上，变成肉眼可见的图像，操作系统来处理

绘制发生的频率很高，鼠标滑过浏览器显示区域，每次移动都会造成了重新绘制